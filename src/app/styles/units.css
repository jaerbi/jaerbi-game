.combat-stage {
  position: relative;
  width: 100%;
  height: 60px;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
  overflow: hidden;
}
.combat-stage .attacker {
  position: absolute;
  left: 20px;
  top: 15px;
  width: 30px;
  height: 30px;
  background: #3b82f6;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}
.combat-stage .defender {
  position: absolute;
  right: 20px;
  top: 15px;
  width: 30px;
  height: 30px;
  background: #ef4444;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}
.combat-stage .triangle {
  clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
  background: #3b82f6;
}
.combat-stage .circle {
  border-radius: 50%;
}
.combat-stage .square {
  border-radius: 4px;
}
.combat-stage .defender-fade {
  animation: fadeOut 1s ease-out forwards 1s;
}
@keyframes fadeOut {
  to { opacity: 0; transform: scale(0.5); }
}
.crit-pop {
  position: absolute;
  right: 10px;
  top: -5px;
  color: #fbbf24;
  font-weight: 900;
  font-size: 14px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  animation: popUp 0.5s ease-out;
}
.miss-pop {
  position: absolute;
  right: 15px;
  top: 0;
  color: #9ca3af;
  font-weight: 700;
  font-size: 12px;
  animation: floatUp 1s ease-out forwards;
}
@keyframes popUp {
  0% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1.5); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}
@keyframes floatUp {
  to { transform: translateY(-20px); opacity: 0; }
}
.path-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 2px;
  width: 100%;
  aspect-ratio: 6/4;
  background: rgba(0,0,0,0.3);
  padding: 4px;
  border-radius: 4px;
  position: relative;
}
.path-cell {
  background: rgba(255,255,255,0.05);
  border-radius: 2px;
}
.path-cell.active {
  background: rgba(59, 130, 246, 0.15);
  border: 1px solid rgba(59, 130, 246, 0.3);
}
.path-animation {
  position: absolute;
  left: calc(var(--start-x) * 16.66%);
  top: calc(var(--start-y) * 25%);
  width: calc(16.66% * var(--line-steps));
  height: 2px;
  background: #3b82f6;
  transform-origin: left center;
  animation: growPath 2s ease-in-out infinite;
}
@keyframes growPath {
  0% { transform: scaleX(0); opacity: 0; }
  20% { transform: scaleX(1); opacity: 1; }
  80% { transform: scaleX(1); opacity: 1; }
  100% { transform: scaleX(1); opacity: 0; }
}
.mover {
  position: absolute;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: bold;
  color: white;
  z-index: 10;
}
.t1-path {
  left: calc(16.66% * 2 + 5px);
  top: calc(25% * 2 + 5px);
  background: #3b82f6;
  border-radius: 50%;
  animation: moveT1 2s ease-in-out infinite;
}
@keyframes moveT1 {
  0% { transform: translate(0,0); }
  20% { transform: translate(100%, 0); } /* 1 step right */
  80% { transform: translate(100%, 0); }
  100% { transform: translate(0,0); }
}
.t3-path {
  left: calc(16.66% * 2 + 5px);
  top: calc(25% * 2 + 5px);
  background: #2563eb;
  border-radius: 2px;
  animation: moveT3 2s ease-in-out infinite;
}
@keyframes moveT3 {
  0% { transform: translate(0,0); }
  20% { transform: translate(300%, 0); } /* 3 steps right */
  80% { transform: translate(300%, 0); }
  100% { transform: translate(0,0); }
}

/* --- NEW SVG & UNIT STYLES --- */

.theme-player {
  --u-fill: #3b82f6;
  --u-stroke: #60a5fa;
  --u-core: #93c5fd;
  --u-light: #bfdbfe;
  --u-font: #e2efff;
  --u-dark: #2563eb;
  --u-bg-glow: rgba(59, 130, 246, 0.5);
  --u-emerald: #10b981; /* Keep T4 distinct or map to blue? User said blue-ish. Let's map emerald to a teal/cyan for player T4 */
  --u-emerald-stroke: #34d399;
}

.theme-ai {
  --u-fill: #ef4444;
  --u-stroke: #f87171;
  --u-core: #fca5a5;
  --u-light: #fecaca;
  --u-font: #fff4f4;
  --u-dark: #dc2626;
  --u-bg-glow: rgba(239, 68, 68, 0.5);
  --u-emerald: #b91c1c; /* Red T4 */
  --u-emerald-stroke: #ef4444;
}

.unit-svg-wrapper {
    width: 100% !important;
    height: 100% !important;
    display: flex;
    align-items: center;
    justify-content: center;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
    transition: transform 0.2s ease-out, filter 0.2s;
    position: relative; 
    overflow: visible;
}

.unit-svg-wrapper:hover {
    transform: scale(1.1);
    filter: drop-shadow(0 0 12px var(--u-bg-glow));
}

.move-anim {
    transition: transform 0.3s ease-out;
}

@keyframes lunge {
  0% { transform: translate(0,0); }
  40% { transform: translate(calc(var(--target-dx, 0) * 20px), calc(var(--target-dy, 0) * 20px)); }
  100% { transform: translate(0,0); }
}

.attack-anim {
    animation: lunge 0.3s ease-in-out;
}

@keyframes merge-pop {
    0% { transform: scale(1); filter: brightness(1); }
    50% { transform: scale(1.2); filter: brightness(2); }
    100% { transform: scale(1); filter: brightness(1); }
}

.merge-anim {
    animation: merge-pop 0.4s ease-out;
}

.fatigued {
    filter: grayscale(0.7) opacity(0.8) !important;
}
