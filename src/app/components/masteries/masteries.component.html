<div class="min-h-screen bg-slate-900 text-white flex flex-col items-center">
  <div
    class="min-h-screen bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black text-white flex flex-col items-center py-4 px-4 selection:bg-sky-500/30"
  >
    <div
      class="w-full max-w-6xl bg-slate-800/50 backdrop-blur-md border border-slate-700/50 rounded-2xl shadow-2xl overflow-hidden"
    >
      <div
        class="p-6 border-b border-slate-700/50 bg-slate-900/40 flex flex-col md:flex-row items-center justify-between gap-6"
      >
        <div class="flex items-center gap-4">
          <a
            routerLink="/tower-defense"
            class="group flex items-center gap-2 px-5 py-2.5 bg-slate-700/50 hover:bg-slate-600 rounded-xl text-sm font-bold transition-all border border-slate-600/50 hover:border-sky-500/50 shadow-lg"
          >
            <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span>
            {{ settings.t('BACK_TO_DEFENSE') }}
          </a>
          <h1
            class="text-3xl font-black tracking-tighter uppercase italic text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400"
          >
            {{ settings.t('MASTERIES') }}
          </h1>
        </div>

        <div class="flex items-center gap-3" *ngIf="profile(); else noProfile">
          <div class="flex flex-col items-end px-4 py-2 bg-black/30 rounded-xl border border-slate-700/50">
            <span class="text-[10px] uppercase font-bold text-slate-500">{{ settings.t('TOTAL_XP') }}</span>
            <span class="font-mono text-lg text-emerald-400 leading-none">{{ profile()?.totalXp }}</span>
          </div>
          <div class="flex flex-col items-end px-4 py-2 bg-black/30 rounded-xl border border-slate-700/50">
            <span class="text-[10px] uppercase font-bold text-slate-500">{{ settings.t('AVAILABLE') }}</span>
            <span class="font-mono text-lg text-sky-400 leading-none">{{ availablePoints() }}</span>
          </div>
          <div
            *ngIf="isSaved() && !saving()"
            class="flex items-center gap-2 px-3 py-1 bg-emerald-500/10 rounded-xl border border-emerald-500/30"
          >
            <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
            <span class="text-[10px] font-bold uppercase tracking-wide text-emerald-300">
              {{ settings.t('SAVED') }}
            </span>
          </div>
        </div>

        <ng-template #noProfile>
          <div
            class="px-6 py-2 bg-rose-500/10 border border-rose-500/20 rounded-xl text-rose-400 text-xs animate-pulse"
          >
            {{ settings.t('LOG_IN_MASTERY_MSG') }}
          </div>
        </ng-template>
      </div>

      <div class="p-8">
        <div *ngIf="!user(); else loggedInBlock" class="flex flex-col items-center justify-center py-20 text-center">
          <div
            class="w-20 h-20 bg-slate-700/30 rounded-full flex items-center justify-center mb-6 border border-slate-600"
          >
            <span class="text-4xl">üîí</span>
          </div>
          <p class="text-slate-400 max-w-md mb-8 leading-relaxed">{{ settings.t('NEED_LOG_IN') }}</p>
          <button
            (click)="login()"
            class="px-8 py-4 bg-sky-600 hover:bg-sky-500 hover:scale-105 active:scale-95 rounded-2xl text-base font-black transition-all shadow-[0_0_20px_rgba(14,165,233,0.4)]"
          >
            {{ settings.t('LOGIN_GOOGLE') }}
          </button>
        </div>

        <ng-template #loggedInBlock>
          <div class="space-y-8">
            <div class="flex items-center gap-3">
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-slate-600 to-transparent"></div>
              <p class="text-sm font-medium text-slate-400 tracking-wide">{{ settings.t('MASTERIES_SUBTITLE') }}</p>
              <div class="h-px flex-1 bg-gradient-to-r from-transparent via-slate-600 to-transparent"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
              <div
                *ngFor="let tier of tiers"
                class="group relative bg-slate-900/40 rounded-3xl border border-slate-700/50 p-1 transition-all hover:border-slate-500/50 hover:bg-slate-900/60 shadow-xl"
              >
                <div class="p-5">
                  <div class="flex items-center justify-between mb-6">
                    <div
                      class="px-3 py-1 bg-black/40 rounded-lg text-[10px] font-black uppercase tracking-widest text-slate-400 border border-slate-700/50"
                    >
                      {{ settings.t('TIER') }} {{ tier.id }}
                    </div>
                    <div
                      class="w-2 h-2 rounded-full blur-[2px] animate-pulse"
                      [ngClass]="tier.color.replace('text', 'bg')"
                    ></div>
                  </div>

                  <h3 class="text-lg font-black mb-6 tracking-tight" [ngClass]="tier.color">
                    {{ settings.t(tier.nameKey) }}
                  </h3>

                  <div class="space-y-6">
                    <div class="flex items-center justify-between group/item">
                      <div class="flex-1">
                        <div class="text-xs font-bold text-white mb-0.5">{{ settings.t('DAMAGE') }}</div>
                        <div class="text-[10px] text-slate-500">+5% {{ settings.t('PER_LEVEL') }}</div>
                      </div>
                      <div class="flex items-center gap-3">
                        <div class="flex flex-col items-end gap-1">
                          <span
                            class="font-mono text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20"
                          >
                            {{ getUpgradeLevel(tier.id, 'damage') }} / 20
                          </span>
                          <span
                            *ngIf="getUpgradeLevel(tier.id, 'damage') < 20; else dmgMaxed"
                            class="text-[10px] text-slate-400"
                          >
                            {{ settings.t('COST') }}: {{ getNextLevelCost(tier.id, 'damage') }} XP
                          </span>
                          <ng-template #dmgMaxed>
                            <span class="text-[10px] text-amber-400 font-bold uppercase">
                              {{ settings.t('MAXED') }}
                            </span>
                          </ng-template>
                        </div>
                        <button
                          (click)="increaseBasic(tier.id, 'damage')"
                          [disabled]="!canIncreaseBasic(tier.id, 'damage')"
                          class="w-8 h-8 rounded-xl flex items-center justify-center text-xl font-bold transition-all border shadow-lg disabled:opacity-20 disabled:grayscale"
                          [class.bg-emerald-500]="canIncreaseBasic(tier.id, 'damage')"
                          [class.border-emerald-400]="canIncreaseBasic(tier.id, 'damage')"
                          [class.text-slate-900]="canIncreaseBasic(tier.id, 'damage')"
                          [class.hover:scale-110]="canIncreaseBasic(tier.id, 'damage')"
                        >
                          +
                        </button>
                      </div>
                    </div>

                    <div class="flex items-center justify-between group/item">
                      <div class="flex-1">
                        <div class="text-xs font-bold text-white mb-0.5">{{ settings.t('RANGE') }}</div>
                        <div class="text-[10px] text-slate-500">+0.1 {{ settings.t('PER_LEVEL') }}</div>
                      </div>
                      <div class="flex items-center gap-3">
                        <div class="flex flex-col items-end gap-1">
                          <span
                            class="font-mono text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20"
                          >
                              {{ getUpgradeLevel(tier.id, 'range') }} / 20
                          </span>
                          <span
                              *ngIf="getUpgradeLevel(tier.id, 'range') < 20; else rangeMaxed"
                            class="text-[10px] text-slate-400"
                          >
                            {{ settings.t('COST') }}: {{ getNextLevelCost(tier.id, 'range') }} XP
                          </span>
                          <ng-template #rangeMaxed>
                            <span class="text-[10px] text-amber-400 font-bold uppercase">
                              {{ settings.t('MAXED') }}
                            </span>
                          </ng-template>
                        </div>
                        <button
                          (click)="increaseBasic(tier.id, 'range')"
                          [disabled]="!canIncreaseBasic(tier.id, 'range')"
                          class="w-8 h-8 rounded-xl flex items-center justify-center text-xl font-bold transition-all border shadow-lg disabled:opacity-20 disabled:grayscale"
                          [class.bg-emerald-500]="canIncreaseBasic(tier.id, 'range')"
                          [class.border-emerald-400]="canIncreaseBasic(tier.id, 'range')"
                          [class.text-slate-900]="canIncreaseBasic(tier.id, 'range')"
                          [class.hover:scale-110]="canIncreaseBasic(tier.id, 'range')"
                        >
                          +
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  class="mt-2 p-5 bg-gradient-to-b from-amber-500/5 to-amber-500/10 rounded-b-[22px] border-t border-amber-500/20"
                >
                  <div class="flex items-start justify-between gap-4">
                    <div class="flex-1">
                      <div class="text-xs font-black uppercase tracking-wider text-amber-400 mb-1">
                        {{ settings.t(tier.goldenTitleKey) }}
                      </div>
                      <div class="text-[11px] text-slate-300 leading-relaxed italic">
                        {{ settings.t(tier.goldenDescriptionKey) }}
                      </div>
                      <div
                        class="mt-3 inline-block px-2 py-1 rounded bg-black/40 border border-amber-500/20"
                        *ngIf="!canUnlockGolden(tier.id)"
                      >
                        <div class="text-[9px] text-amber-500/80 uppercase font-bold">
                          üîí {{ settings.t('REQUIRES_5_POINTS') }}
                        </div>
                      </div>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                      <div class="flex flex-col items-center gap-1">
                        <span class="font-mono text-xs text-amber-400">
                          {{ getUpgradeLevel(tier.id, 'golden') }} / 1
                        </span>
                        <span
                          *ngIf="getUpgradeLevel(tier.id, 'golden') < 1; else goldenMaxed"
                          class="text-[10px] text-amber-200"
                        >
                          {{ settings.t('COST') }}: {{ getNextLevelCost(tier.id, 'golden') }} XP
                        </span>
                        <ng-template #goldenMaxed>
                          <span class="text-[10px] text-amber-400 font-bold uppercase">
                            {{ settings.t('MAXED') }}
                          </span>
                        </ng-template>
                      </div>
                      <button
                        (click)="increaseGolden(tier.id)"
                        [disabled]="!canIncreaseGolden(tier.id)"
                        class="w-10 h-10 rounded-2xl flex items-center justify-center text-2xl font-black transition-all border-2 shadow-[0_0_15px_rgba(245,158,11,0.3)] disabled:opacity-20 disabled:grayscale disabled:shadow-none"
                        [class.bg-amber-500]="canIncreaseGolden(tier.id)"
                        [class.border-amber-400]="canIncreaseGolden(tier.id)"
                        [class.text-slate-950]="canIncreaseGolden(tier.id)"
                        [class.hover:scale-110]="canIncreaseGolden(tier.id)"
                      >
                        +
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-slate-900/70 border border-amber-500/30 rounded-2xl px-4 py-3 w-full md:w-auto">
              <div class="flex items-center justify-between gap-4">
                <div>
                  <div class="text-xs font-black uppercase tracking-wider text-amber-400">
                    {{ settings.t('GOLD_MASTERY') }}
                  </div>
                  <div class="text-[11px] text-slate-300">
                  {{ settings.t('COST') }}: {{ getGoldNextLevelCost() }} XP
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <div class="flex flex-col items-end gap-1">
                    <span class="font-mono text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20">
                       {{ getGoldMasteryLevel() }} / 20
                    </span>
                  </div>
                  <button
                    (click)="increaseGold()"
                    [disabled]="!canIncreaseGold()"
                    class="w-9 h-9 rounded-xl flex items-center justify-center text-xl font-bold transition-all border shadow-lg disabled:opacity-20 disabled:grayscale"
                    [class.bg-emerald-500]="canIncreaseGold()"
                    [class.border-emerald-400]="canIncreaseGold()"
                    [class.text-slate-900]="canIncreaseGold()"
                    [class.hover:scale-110]="canIncreaseGold()"
                  >
                    +
                  </button>
                </div>
              </div>
              <div class="mt-2 text-[11px] text-slate-400">
                {{ settings.t('GOLD_MASTERY_INFO') }}
              </div>
            </div>
          </div>

          <div
            class="flex flex-col md:flex-row items-center justify-between mt-12 pt-8 border-t border-slate-700/50 gap-6"
          >
            <div class="flex items-center gap-3 text-slate-500">
              <span class="text-xl">‚ÑπÔ∏è</span>
              <p class="text-xs italic">{{ settings.t('LOCAL_STORAGE_MSG') }}</p>
            </div>

            <div class="flex flex-col items-end gap-4">
              

              <button
              (click)="save()"
              [disabled]="!profile() || saving() || isSaved()"
              class="group relative px-10 py-4 rounded-2xl font-black uppercase tracking-widest transition-all overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"
              [class.bg-emerald-600]="profile() && !saving()"
              [class.text-white]="profile() && !saving()"
              [class.shadow-[0_0_30px_rgba(16,185,129,0.4)]]="profile() && !saving()"
              [class.bg-slate-700]="!profile() || saving()"
            >
              <span class="relative z-10 flex items-center gap-2">
                @if (saving()) {
                    <span
                      class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"
                    ></span>
                }
                {{ saving() ? settings.t('SAVING') : settings.t('SAVE_CHANGES') }}
              </span>
              <div
                class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform"
              ></div>
            </button>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
